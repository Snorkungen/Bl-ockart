(()=>{"use strict";function t(t,e,...o){const s=document.createElement(e);return null!==o&&o.length>0&&o.forEach((t=>{if(t){let[e,o]=t.split("=");o=t.split("=").slice(1).join("="),"content"===e?s.textContent=o:s.setAttribute(e,o)}})),t&&t.appendChild(s),s}class e extends HTMLElement{constructor({ttl:e,msg:s}){super(),setTimeout((()=>this.remove()),e),t(this,"p",`content=${s}`),this.removeButton=t(this,"button"),this.removeButton.innerHTML="&times;",this.removeButton.addEventListener("click",(({target:t})=>o(t,"sk-toast-message").remove()))}}customElements.define("sk-toast-message",e);function o(t,e){return t.localName===e?t:o(t.parentNode,e)}class s extends HTMLElement{constructor({blockAmount:t,blockSize:o,blockColor:s}){super(),this.blockAmount=t,this.blockSize=o,this.blockColor=s,this.activeColor=this.blockColor,this.Toast=new class{constructor(){this.elem=document.getElementById("toastContainer")}message(t){this.elem.appendChild(new e(t))}},this.ToastTTL=5e3,this.Modal=document.getElementsByTagName("sk-modal")[0]}get gap(){return this.currgap}set gap(t){this.currgap=t,this.style.gap=`${this.currgap}px`}getMaximumBlockSize(){let t=window.innerHeight,e=window.innerWidth;this.parentNode&&this.parentNode.navbar&&(t-=this.parentNode.navbar.clientHeight);const o=e<t?e:t;return Math.floor(o/this.blockAmount-4)}setActiveColor(t){return this.activeColor=t,this}forEachBlock(t){for(let e=0;e<this.children.length;e++)for(let o=0;o<this.children[e].children.length;o++)t(this.children[e].children[o],{x:o,y:e})}forEachRow(t){for(let e=0;e<this.children.length;e++)t(this.children[e],{y:e})}}class i extends HTMLElement{constructor({blockSize:t,blockColor:e,index:o}){super(),(o||0===o)&&(this.blockIndex=o),this.colors=[],this.setSize(t),this.setColor(e)}setSize(t){return this.size=t,this.style.width=`${this.size}px`,this.style.height=`${this.size}px`,this}setColor(t){return this.color!==t&&(this.color=t,this.style.background=this.color,this.colors[this.colors.length-1]!==this.color&&(this.colors.push(t),this))}revertColor(){if(!(this.colors.length<=1))return this.colors.pop(),this.setColor(this.colors[this.colors.length-1]),this}}class l extends HTMLElement{update(){}}class r extends HTMLElement{constructor({color:t,size:e}){super(),this.id="brush",this.size=e,this.color="#323232",this.style.display="block",this.style.position="absolute",this.style.width=e+"px",this.style.height=e+"px",this.style.borderRadius="50%",this.style.border=`thin solid ${this.color}`,window.addEventListener("mousemove",this.mouseMoveHandler)}set pos([t,e]){this.style.left=t-this.size/2+"px",this.style.top=e-this.size/2+"px"}mouseMoveHandler(t){let e=document.getElementById("brush");e&&(e.pos=[t.pageX,t.pageY])}}customElements.define("sk-brush",r);class n extends Array{get first(){return this[0]}get last(){return this[this.length-1]}get lastIndex(){return this.length-1}}function h(t){if(!t)return[];const e=t.parentNode.previousSibling||{children:!1},o=t.parentNode.nextSibling||{children:!1},s=e.children[t.blockIndex]||null,i=e.children[t.blockIndex+1]||null,l=e.children[t.blockIndex-1]||null,r=o.children[t.blockIndex]||null,n=o.children[t.blockIndex+1]||null,h=o.children[t.blockIndex-1]||null;return[s,r,t.nextSibling,t.previousSibling,i,l,h,n]}function c(t,e){const o=h(t);for(let t=0;t<o.length;t++)if(o[t]==e)return t}class a extends s{constructor({blockAmount:t,blockSize:e,blockColor:o}){super({blockAmount:t,blockSize:e,blockColor:o}),this.setBlocks(this.blockAmount)}setBlocks(t){for(let e=0;e<t;e++)this.appendChild(new i({blockSize:this.blockSize,blockColor:this.blockColor,index:e}))}}class u extends s{constructor({blockAmount:t,blockSize:e,blockColor:o}){super({blockAmount:t,blockSize:e,blockColor:o}),this.activeColor=this.blockColor,this.baseColor=this.blockColor,this.history=new class{constructor(t={}){this.history=new n,this.maxHistoryLength=t.maxHistoryLength||100,this.dragLength=t.dragLength||10,this.dragColor=null,this.lastFillIndex=null}remove(){return this.history.pop(),this}trimHistory(){this.history.length>this.maxHistoryLength&&this.history.shift()}click(t){return this.history.push([t]),this.trimHistory()}drag(t){if(this.history.last){const e=this.history.last;if(e.length<this.dragLength&&e[e.length-1].color==this.dragColor)return e.push(t),this.trimHistory()}return this.dragColor=t.color,this.history.push([t]),this.trimHistory()}fill(t){if(null!==this.lastFillIndex){const e=this.history[this.lastFillIndex];if(e)return e.push(t),this.trimHistory();console.error("Some random error if i cant debug")}return this.history.push([t]),this.trimHistory(),this.lastFillIndex=this.history.lastIndex}fillReset(){this.lastFillIndex=null}get state(){return this.history.last}},this.setRows(this.blockAmount),this.setGap(0),this.brushFillToggle=!1,this.brushFillSize=3,this.selectOutlineToggle=!1,this.addEventListener("mousedown",this.clickHandler),this.addEventListener("mouseover",this.mouseOverHandler),this.addEventListener("dragstart",(t=>t.preventDefault())),this.addEventListener("contextmenu",(t=>t.preventDefault())),document.addEventListener("keydown",(t=>{t.ctrlKey&&"z"===t.key&&this.revertHistory()}))}setRows(t){for(let e=0;e<t;e++)this.blockAmount=t,this.appendChild(new a({blockAmount:this.blockAmount,blockColor:this.blockColor,blockSize:this.blockSize}));return this}scaleBlocks(t){this.blockSize=t,this.forEachBlock((e=>{e.setSize(t)}))}scaleBoard(t){if(t>0){this.forEachRow((e=>{for(let o=0;o<t;o++)e.appendChild(new i({blockSize:this.blockSize,blockColor:this.blockColor,index:this.blockAmount+o}))}));for(let e=0;e<t;e++)this.appendChild(new a({blockAmount:this.blockAmount+t,blockColor:this.blockColor,blockSize:this.blockSize}))}else{this.forEachRow((e=>{for(let o=0;o<-1*t;o++)e.children[e.children.length-1].remove()}));for(let e=0;e<-1*t;e++)this.children[this.children.length-1].remove()}return this.blockAmount+=t,this.setGap(this.currgap),this.scaleBlocks(this.getMaximumBlockSize())}saveBoardState(){const t=[];return this.forEachBlock(((e,{x:o,y:s})=>{t.push({x:o,y:s,color:e.color,colors:e.colors})})),t}toggleGap(){let t=0;return 0===this.gap&&(t=1),this.setGap(t)}revertHistory(){return(this.history.state?this.history.state:[]).forEach((t=>t.revertColor())),this.history.remove(),this}setGap(t){this.gap=t,this.forEachRow((e=>{e.gap=t}))}setUpdateActiveColorFunction(t){this.updateActiveColor=t}copyColor({target:t}){return this.setActiveColor(t.color),this.updateActiveColor&&this.updateActiveColor(t.color),this}clickHandler(t){if("sk-block"===t.target.localName)return t.ctrlKey?this.fillImproved(t.target):!t.ctrlKey&&t.shiftKey?this.copyColor(t):this.brushFillToggle?this.brushFill(t.target):this.selectOutlineToggle?this.selectOutline(t.target):(t.target.setColor(this.activeColor)&&this.history.click(t.target),this)}mouseOverHandler(t){if("sk-block"===t.target.localName&&t.buttons)return this.brushFillToggle?this.brushFill(t.target):(t.target.setColor(this.activeColor)&&this.history.drag(t.target),this)}wheelHandler(t){if(!t.shiftKey)return this;const e=this.getMaximumBlockSize();return this.blockSize+=t.deltaY<0?4:-4,e<this.blockSize||10>this.blockSize?this:void this.forEachBlock((t=>{t.setSize(this.blockSize)}))}fillRowColor(t,e,o){const s=t.color;t.setColor(e),o.fill(t),function t(i){if(i&&i.color===s)return i.setColor(e)&&o.fill(i),t(i.nextSibling)}(t.nextSibling),function t(i){if(i&&i.color===s)return i.setColor(e)&&o.fill(i),t(i.previousSibling)}(t.previousSibling)}fillColor(t){const e=t.color,o=this.activeColor,s=t.blockIndex,i=this.history,l=this.fillRowColor;this.fillRowColor(t,o,i),function t(r){if(!r)return;const n=r.children[s];return n.color===e?(l(n,o,i),t(r.nextSibling)):void 0}(t.parentNode.nextSibling),function t(r){if(!r)return;const n=r.children[s];return n.color===e?(l(n,o,i),t(r.previousSibling)):void 0}(t.parentNode.previousSibling),this.history.fillReset()}toggleBrushFill(){return this.brushFillToggle?(this.brushTooltip&&this.brushTooltip.remove(),this.brushFillToggle=!1):(this.brushTooltip=new r({color:"black",size:Math.round(this.blockSize*this.brushFillSize)}),document.body.appendChild(this.brushTooltip),this.brushFillToggle=!0)}brushFill(t){const e=Math.floor((this.brushFillSize-1)/2),o=this.activeColor,s=t.blockIndex,i=this.history;function l(t,e,s,r){if(r<=0||!t)return;const n=t.children[s];return n.setColor(o)&&i.fill(n),l("P"===e?t.previousSibling:t.nextSibling,e,s,r-1)}function r(t,e,s){if(!(s<=0)&&t)return l(t.parentNode.previousSibling,"P",t.blockIndex,s),l(t.parentNode.nextSibling,"N",t.blockIndex,s),t.setColor(o)&&i.fill(t),r("P"===e?t.previousSibling:t.nextSibling,e,s-1)}return r(t.previousSibling,"P",e),r(t.nextSibling,"N",e),l(t.parentNode.previousSibling,"P",s,e),l(t.parentNode.nextSibling,"N",s,e),t.setColor(o)&&i.fill(t),this.history.fillReset()}findEdge(t){const e=t.color;return function t(o){const s=o.parentNode.nextSibling;if(!s)return o;const i=s.children[o.blockIndex];return i&&i.color===e?t(i):o}(function t(o){const s=o.nextSibling;return s&&s.color===e?t(s):o}(t))}selectOutline(t){const e=(t=this.findEdge(t)).color,o=[];return function t(s,i=0){const l=o[o.length-1];o.push(s);const r=h(s).map((t=>!!t&&t.color===e&&!o.includes(t)&&t));if(r.length<=0)return s;if(r.length<=0||function(t){let o=0;for(let s=0;s<t.length;s++){let i=0;h(t[s]).forEach((t=>{t&&t.color===e||(i+=1)})),o+=i}return!(o>1)}(r))return s;let n=null;l&&s&&(n=c(l,s));let a=0;for(let t=0;t<r.length;t++){let o=0;const s=r[t];if(null!==n&&n==t&&(o+=2),h(s).forEach(((t,s)=>{if(!t||t.color!==e)return o+=s<4?1.5:1})),o>a){a=o;const e=r[0];r[t]=e,r[0]=s}}return r[0]?t(r[0],i+1):s}(t),console.log(o),o.forEach((t=>t.classList.add("active")))}fillImproved(t){const e=(t=this.findEdge(t)).color,o=this.activeColor;return function t(s,i=null){s.setColor(o);const l=h(s).map((t=>!!t&&t.color===e&&t));if(l.length<=0)return s;let r=null;i&&s&&(r=c(i,s));let n=0;for(let t=0;t<l.length;t++){let s=0;const i=l[t];if(null!==r&&r==t&&(s+=1),h(i).forEach(((t,i)=>(i<4&&(s+=5),!t||t.color!==e&&t.color!==o?s+=1:t.color==o?s+=3:void 0))),s>n){n=s;const e=l[0];l[t]=e,l[0]=i}}return l[0]?setTimeout((()=>t(l[0],s)),50):void 0}(t)}__initState(t){this.scaleBoard(t.size-this.blockAmount),this.activeColor=t.paletteColors[0];for(let e=0;e<t.blockValues.length;e++){const{x:o,y:s,color:i,colors:l}=t.blockValues[e];this.children[s].children[o].setColor(i),this.children[s].children[o].colors=l}}}class d{constructor(t){this.key=t,this.state.forEach(((t,e)=>{this[e]=t}))}updateBoard(t,e){const o=this.state;return o[t]=e,this[t]=e,localStorage.setItem(this.key,JSON.stringify(o))}deleteBoard(t){const e=this.state;return e[t]=null,this[t]=null,localStorage.setItem(this.key,JSON.stringify(e))}saveNewBoard(t){const e=this.state;return e.push(t),this[e.length]=t,localStorage.setItem(this.key,JSON.stringify(e))}get state(){const t=localStorage.getItem(this.key);return Array.isArray(JSON.parse(t))?JSON.parse(t):[]}get length(){return this.state.length}}const b=class{constructor(t){this.blockArtBoard=t,this.LcAPi=new d("BoardStates"),this.__initRoute()}__initRoute(){const t=window.location.search;if(!t)return void this.loadRoute(this.LcAPi.length);const e=t.substr(1).split("id=")[1];return this.loadBoard(e)}loadBoard(t){if(!t)return;const e=this.LcAPi[parseInt(t)];e&&this.blockArtBoard.__initState(e)}loadRoute(t){const e=new URL(window.location);e.searchParams.set("id",t),window.history.pushState({},"",e),this.loadBoard(t)}};class p extends l{constructor(e){super(),this.board=e,this.blockAmountInput=this.createInput("Board size","type=number",`value=${this.blockAmount}`),this.brushSizeInput=this.createInput("Brush size","type=number",`value=${this.brushSize}`),this.gapToggle=t(this,"button","content=Toggle board gap!"),this.gapToggle.addEventListener("click",(({target:t})=>o(t,"sk-settings").board.toggleGap())),this.blockAmountInput.addEventListener("input",this.unsavedNotice),this.blockAmountInput.addEventListener("keyup",this.blockAmountInputKeyUpHandler),this.brushSizeInput.addEventListener("input",this.unsavedNotice),this.brushSizeInput.addEventListener("keyup",this.brushSizeInputKeyUpHandler)}get blockAmount(){return this.board.blockAmount}set blockAmount(t){const e=t-this.blockAmount;this.board.scaleBoard(e)}get brushSize(){return this.board.brushFillSize}set brushSize(t){return this.board.brushFillSize=t>=3?t:3}update(){this.blockAmountInput.value=this.blockAmount,this.brushSizeInput.value=this.brushSize}createInput(e,...o){const s=t(this,"div","class=settings-section");return t(s,"label",`content=${e}`),t(s,"input",...o)}unsavedNotice(t,e){const{target:o}=t;return e?o.classList.remove("unsaved"):o.classList.add("unsaved")}blockAmountInputKeyUpHandler(t){if(13===t.keyCode){const e=o(t.target,"sk-settings"),{target:{value:s}}=t;return e.blockAmount=parseInt(s),e.unsavedNotice(t,!0)}}brushSizeInputKeyUpHandler(t){if(13===t.keyCode){const e=o(t.target,"sk-settings"),{target:{value:s}}=t;return e.brushSize=parseInt(s),e.unsavedNotice(t,!0)}}}customElements.define("sk-settings",p);const k=p;class g extends HTMLElement{constructor(e,s){super(),this.id=e,this.data=s,this.blockSize=14,this.loadBlocks(),t(this,"hah",`content=${this.id}`),this.addEventListener("click",(()=>{const{router:t}=o(this,"sk-saved");t.loadRoute(this.id)}))}loadBlocks(){const{paletteColors:t}=this.data;this.innerHTML="",this.createBlock(t[0]),this.createBlock(t[1]),this.createBlock(t[t.length-1]),this.createBlock(t[t.length-2])}createBlock(t){const e=new i({blockSize:this.blockSize,blockColor:t,index:0});this.appendChild(e)}}class m extends l{constructor(t){super(),this.blockArtBoard=t,this.LcAPI=new d("BoardStates"),this.router=new b(this.blockArtBoard),this.loadBoardIcons()}loadBoardIcons(){const t=this.LcAPI.state;this.innerHTML="",t.forEach(((t,e)=>{this.appendChild(new g(e,t))}))}}customElements.define("sk-saved-icon",g),customElements.define("sk-saved",m);const C=m;class v extends s{constructor(t){super(t),this.blockSize=42,this.activeColorBlock=new i({...t,blockSize:this.blockSize}),this.availableColorsRow=new a({blockSize:this.blockSize,blockColor:t.blockColor,blockAmount:t.paletteColors.length}),this.paletteColors=t.paletteColors,this.setActiveColor(this.paletteColors[0]),this.style.display="flex",this.style.flexDirection="row",this.activeColorBlock.id="activeColorBlock",this.appendChild(this.activeColorBlock),this.appendChild(this.availableColorsRow),this.forEachBlock(((t,{x:e})=>{t.setColor(this.paletteColors[e]),t.addEventListener("click",(({target:t})=>{this.setActiveColor(t.color),this.updateActiveColor&&this.updateActiveColor(t.color)}))}))}resetColorPallette(t){this.paletteColors=t,this.forEachBlock(((t,{x:e})=>t.setColor(this.paletteColors[e]))),this.setActiveColor(this.paletteColors[0])}setUpdateActiveColorFunction(t){this.updateActiveColor=t}setActiveColor(t){return this.activeColor=t,this.activeColorBlock.setColor(t),this}}class f extends s{constructor(e){super(e),this.palletteColorAmount=12,this.paletteColors=new Array(this.palletteColorAmount).fill(0).map((()=>"#"+(16777216+16777215*Math.random()).toString(16).substr(1,6))),this.colorPalette=new v({...e,paletteColors:this.paletteColors}),this.board=new u({...e,blockSize:this.getMaximumBlockSize()}),this.activeColor=this.paletteColors[0],this.colorPalette.setActiveColor(this.activeColor),this.board.setActiveColor(this.activeColor),this.colorPalette.setUpdateActiveColorFunction((t=>(this.setActiveColor(t),this.board.setActiveColor(t),this))),this.board.setUpdateActiveColorFunction((t=>(this.setActiveColor(t),this.colorPalette.setActiveColor(t),this))),this.navbar=t(this,"nav","id=blockArtNavbar"),this.funcButtonContainer=t(this.navbar,"div","id=funcButtonContainer"),t(this.funcButtonContainer,"button","content=Boards").addEventListener("click",(t=>o(this,"sk-bl-ockart").Modal.show(this.Saved))),t(this.funcButtonContainer,"button","content=Settings").addEventListener("click",(t=>o(this,"sk-bl-ockart").Modal.show(this.Settings))),t(this.funcButtonContainer,"button","content=Save Board").addEventListener("click",this.saveBoard),t(this.funcButtonContainer,"button","content=ToggleBrush").addEventListener("click",(t=>o(this,"sk-bl-ockart").board.toggleBrushFill())),this.navbar.appendChild(this.colorPalette),this.appendChild(this.board),this.Settings=new k(this.board),this.Saved=new C(this)}__initState(t){this.colorPalette.resetColorPallette(t.paletteColors),this.board.__initState(t)}saveBoard(t){const e=o(this,"sk-bl-ockart"),s={size:e.board.blockAmount,paletteColors:e.paletteColors,gap:e.board.gap,blockValues:e.board.saveBoardState()},i=new d("BoardStates"),l=window.location.search;if(l){const t=l.substr(1).split("id=")[1];return i.updateBoard(Number(t),s),e.Toast.message({ttl:e.ToastTTL,msg:"Board saved!"})}return i.saveNewBoard(s),e.Toast.message({ttl:e.ToastTTL,msg:"Board saved!"})}}customElements.define("sk-bl-ockart",f),customElements.define("sk-color-palette",v),customElements.define("sk-board",u),customElements.define("sk-block",i),customElements.define("sk-row",a);const S=f;class y extends HTMLElement{constructor(){super(),this.currContent=null,this.container=t(this,"aside"),this.containerHeader=t(this.container,"nav"),this.modalCloseButton=t(this.containerHeader,"button"),this.modalContentContainer=t(this.container,"div"),this.modalCloseButton.innerHTML="&times;",this.addEventListener("click",this.clickHandler)}hide(){return this.style.display="none"}show(t){return t.update(),this.content=t,this.style.display="flex"}clickHandler(t){const{target:e}=t;if("button"===e.localName&&"nav"===e.parentNode.localName||"sk-modal"===e.localName)return this.hide()}set content(t){this.currContent=t,this.modalContentContainer.innerHTML="",this.modalContentContainer.appendChild(t)}}customElements.define("sk-modal",y);const x=y,B=document.getElementById("root");t(B,"aside","id=toastContainer");const A=new x;document.body.appendChild(A);const z=new S({blockAmount:22,blockSize:22,blockColor:"#e0e0e0"});B.appendChild(z),new b(z)})();