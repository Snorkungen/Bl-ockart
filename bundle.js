(()=>{"use strict";function t(t,o,...e){const s=document.createElement(o);return null!==e&&e.length>0&&e.forEach((t=>{if(t){let[o,e]=t.split("=");e=t.split("=").slice(1).join("="),"content"===o?s.textContent=e:s.setAttribute(o,e)}})),t&&t.appendChild(s),s}class o extends HTMLElement{constructor({ttl:o,msg:s}){super(),setTimeout((()=>this.remove()),o),t(this,"p",`content=${s}`),this.removeButton=t(this,"button"),this.removeButton.innerHTML="&times;",this.removeButton.addEventListener("click",(({target:t})=>e(t,"sk-toast-message").remove()))}}customElements.define("sk-toast-message",o);function e(t,o){return t.localName===o?t:e(t.parentNode,o)}class s extends HTMLElement{constructor({blockAmount:t,blockSize:e,blockColor:s}){super(),this.blockAmount=t,this.blockSize=e,this.blockColor=s,this.activeColor=this.blockColor,this.Toast=new class{constructor(){this.elem=document.getElementById("toastContainer")}message(t){this.elem.appendChild(new o(t))}},this.ToastTTL=5e3}get gap(){return this.currgap}set gap(t){this.currgap=t,this.style.gap=`${this.currgap}px`}getMaximumBlockSize(){let t=window.innerHeight,o=window.innerWidth;this.parentNode&&this.parentNode.navbar&&(t-=this.parentNode.navbar.clientHeight);const e=o<t?o:t;return Math.floor(e/this.blockAmount-4)}setActiveColor(t){return this.activeColor=t,this}forEachBlock(t){for(let o=0;o<this.children.length;o++)for(let e=0;e<this.children[o].children.length;e++)t(this.children[o].children[e],{x:e,y:o})}forEachRow(t){for(let o=0;o<this.children.length;o++)t(this.children[o],{y:o})}}class i extends HTMLElement{constructor({blockSize:t,blockColor:o,index:e}){super(),(e||0===e)&&(this.blockIndex=e),this.colors=[],this.setSize(t),this.setColor(o)}setSize(t){return this.size=t,this.style.width=`${this.size}px`,this.style.height=`${this.size}px`,this}setColor(t){return this.color!==t&&(this.color=t,this.style.background=this.color,this.colors[this.colors.length-1]!==this.color&&(this.colors.push(t),this))}revertColor(){if(!(this.colors.length<=1))return this.colors.pop(),this.setColor(this.colors[this.colors.length-1]),this}}class l extends HTMLElement{constructor({color:t,size:o}){super(),this.id="brush",this.size=o,this.color="#323232",this.style.display="block",this.style.position="absolute",this.style.width=o+"px",this.style.height=o+"px",this.style.borderRadius="30%",this.style.border=`thin solid ${this.color}`,window.addEventListener("mousemove",this.mouseMoveHandler)}set pos([t,o]){this.style.left=t-this.size/2+"px",this.style.top=o-this.size/2+"px"}mouseMoveHandler(t){let o=document.getElementById("brush");o&&(o.pos=[t.pageX,t.pageY])}}customElements.define("sk-brush",l);class r extends Array{get first(){return this[0]}get last(){return this[this.length-1]}get lastIndex(){return this.length-1}}class h extends s{constructor({blockAmount:t,blockSize:o,blockColor:e}){super({blockAmount:t,blockSize:o,blockColor:e}),this.setBlocks(this.blockAmount)}setBlocks(t){for(let o=0;o<t;o++)this.appendChild(new i({blockSize:this.blockSize,blockColor:this.blockColor,index:o}))}}class n extends s{constructor({blockAmount:t,blockSize:o,blockColor:e}){super({blockAmount:t,blockSize:o,blockColor:e}),this.activeColor=this.blockColor,this.baseColor=this.blockColor,this.history=new class{constructor(t={}){this.history=new r,this.maxHistoryLength=t.maxHistoryLength||100,this.dragLength=t.dragLength||10,this.dragColor=null,this.lastFillIndex=null}remove(){return this.history.pop(),this}trimHistory(){this.history.length>this.maxHistoryLength&&this.history.shift()}click(t){return this.history.push([t]),this.trimHistory()}drag(t){if(this.history.last){const o=this.history.last;if(o.length<this.dragLength&&o[o.length-1].color==this.dragColor)return o.push(t),this.trimHistory()}return this.dragColor=t.color,this.history.push([t]),this.trimHistory()}fill(t){if(null!==this.lastFillIndex){const o=this.history[this.lastFillIndex];if(o)return o.push(t),this.trimHistory();console.error("Some random error if i cant debug")}return this.history.push([t]),this.trimHistory(),this.lastFillIndex=this.history.lastIndex}fillReset(){this.lastFillIndex=null}get state(){return this.history.last}},this.setRows(this.blockAmount),this.setGap(0),this.brushFillToggle=!1,this.brushFillSize=3,this.addEventListener("mousedown",this.clickHandler),this.addEventListener("mouseover",this.mouseOverHandler),this.addEventListener("dragstart",(t=>t.preventDefault())),this.addEventListener("contextmenu",(t=>t.preventDefault())),document.addEventListener("keydown",(t=>{t.ctrlKey&&"z"===t.key&&this.revertHistory()}))}setRows(t){for(let o=0;o<t;o++)this.blockAmount=t,this.appendChild(new h({blockAmount:this.blockAmount,blockColor:this.blockColor,blockSize:this.blockSize}));return this}scaleBlocks(t){this.blockSize=t,this.forEachBlock((o=>{o.setSize(t)}))}scaleBoard(t){if(t>0)this.forEachRow((o=>{for(let e=0;e<t;e++)o.appendChild(new i({blockSize:this.blockSize,blockColor:this.blockColor,index:this.blockAmount+e}))})),this.appendChild(new h({blockAmount:this.blockAmount+t,blockColor:this.blockColor,blockSize:this.blockSize}));else{this.forEachRow((o=>{for(let e=0;e<-1*t;e++)o.children[o.children.length-1].remove()}));for(let o=0;o<-1*t;o++)this.children[this.children.length-1].remove()}return this.blockAmount+=t,this.setGap(this.currgap),this.scaleBlocks(this.getMaximumBlockSize())}saveBoardState(){const t=[];return this.forEachBlock(((o,{x:e,y:s})=>{t.push({x:e,y:s,color:o.color,colors:o.colors})})),t}toggleGap(){let t=0;return 0===this.gap&&(t=1),this.setGap(t)}revertHistory(){return(this.history.state?this.history.state:[]).forEach((t=>t.revertColor())),this.history.remove(),this}setGap(t){this.gap=t,this.forEachRow((o=>{o.gap=t}))}setUpdateActiveColorFunction(t){this.updateActiveColor=t}copyColor({target:t}){return this.setActiveColor(t.color),this.updateActiveColor&&this.updateActiveColor(t.color),this}clickHandler(t){if("sk-block"===t.target.localName)return t.ctrlKey?this.fillColor(t.target):!t.ctrlKey&&t.shiftKey?this.copyColor(t):this.brushFillToggle?this.brushFill(t.target):(t.target.setColor(this.activeColor)&&this.history.click(t.target),this)}mouseOverHandler(t){if("sk-block"===t.target.localName&&t.buttons)return this.brushFillToggle?this.brushFill(t.target):(t.target.setColor(this.activeColor)&&this.history.drag(t.target),this)}wheelHandler(t){if(!t.shiftKey)return this;const o=this.getMaximumBlockSize();return this.blockSize+=t.deltaY<0?4:-4,o<this.blockSize||10>this.blockSize?this:void this.forEachBlock((t=>{t.setSize(this.blockSize)}))}fillRowColor(t,o,e){const s=t.color;t.setColor(o),e.fill(t),function t(i){if(i&&i.color===s)return i.setColor(o)&&e.fill(i),t(i.nextSibling)}(t.nextSibling),function t(i){if(i&&i.color===s)return i.setColor(o)&&e.fill(i),t(i.previousSibling)}(t.previousSibling)}fillColor(t){const o=t.color,e=this.activeColor,s=t.blockIndex,i=this.history,l=this.fillRowColor;this.fillRowColor(t,e,i),function t(r){if(!r)return;const h=r.children[s];return h.color===o?(l(h,e,i),t(r.nextSibling)):void 0}(t.parentNode.nextSibling),function t(r){if(!r)return;const h=r.children[s];return h.color===o?(l(h,e,i),t(r.previousSibling)):void 0}(t.parentNode.previousSibling),this.history.fillReset()}toggleBrushFill(){return this.brushFillToggle?(this.brushTooltip&&this.brushTooltip.remove(),this.brushFillToggle=!1):(this.brushTooltip=new l({color:"black",size:Math.round(this.blockSize*this.brushFillSize)}),document.body.appendChild(this.brushTooltip),this.brushFillToggle=!0)}brushFill(t){const o=Math.floor((this.brushFillSize-1)/2),e=this.activeColor,s=t.blockIndex,i=this.history;function l(t,o,s,r){if(r<=0||!t)return;const h=t.children[s];return h.setColor(e)&&i.fill(h),l("P"===o?t.previousSibling:t.nextSibling,o,s,r-1)}function r(t,o,s){if(!(s<=0)&&t)return l(t.parentNode.previousSibling,"P",t.blockIndex,s),l(t.parentNode.nextSibling,"N",t.blockIndex,s),t.setColor(e)&&i.fill(t),r("P"===o?t.previousSibling:t.nextSibling,o,s-1)}return r(t.previousSibling,"P",o),r(t.nextSibling,"N",o),l(t.parentNode.previousSibling,"P",s,o),l(t.parentNode.nextSibling,"N",s,o),t.setColor(e)&&i.fill(t),this.history.fillReset()}__initState(t){this.scaleBoard(t.size-this.blockAmount),this.activeColor=t.paletteColors[0];for(let o=0;o<t.blockValues.length;o++){const{x:e,y:s,color:i,colors:l}=t.blockValues[o];this.children[s].children[e].setColor(i),this.children[s].children[e].colors=l}}}class c{constructor(t){this.key=t,this.state.forEach(((t,o)=>{this[o]=t}))}updateBoard(t,o){const e=this.state;return e[t]=o,this[t]=o,localStorage.setItem(this.key,JSON.stringify(e))}deleteBoard(t){const o=this.state;return o[t]=null,this[t]=null,localStorage.setItem(this.key,JSON.stringify(o))}saveNewBoard(t){const o=this.state;return o.push(t),this[o.length]=t,localStorage.setItem(this.key,JSON.stringify(o))}get state(){const t=localStorage.getItem(this.key);return Array.isArray(JSON.parse(t))?JSON.parse(t):[]}get length(){return this.state.length}}class a extends s{constructor(t){super(t),this.blockSize=42,this.activeColorBlock=new i({...t,blockSize:this.blockSize}),this.availableColorsRow=new h({blockSize:this.blockSize,blockColor:t.blockColor,blockAmount:t.paletteColors.length}),this.paletteColors=t.paletteColors,this.setActiveColor(this.paletteColors[0]),this.style.display="flex",this.style.flexDirection="row",this.activeColorBlock.id="activeColorBlock",this.appendChild(this.activeColorBlock),this.appendChild(this.availableColorsRow),this.forEachBlock(((t,{x:o})=>{t.setColor(this.paletteColors[o]),t.addEventListener("click",(({target:t})=>{this.setActiveColor(t.color),this.updateActiveColor&&this.updateActiveColor(t.color)}))}))}resetColorPallette(t){this.paletteColors=t,this.forEachBlock(((t,{x:o})=>t.setColor(this.paletteColors[o]))),this.setActiveColor(this.paletteColors[0])}setUpdateActiveColorFunction(t){this.updateActiveColor=t}setActiveColor(t){return this.activeColor=t,this.activeColorBlock.setColor(t),this}}class u extends s{constructor(o){super(o),this.palletteColorAmount=12,this.paletteColors=new Array(this.palletteColorAmount).fill(0).map((()=>"#"+(16777216+16777215*Math.random()).toString(16).substr(1,6))),this.colorPalette=new a({...o,paletteColors:this.paletteColors}),this.board=new n({...o,blockSize:this.getMaximumBlockSize()}),this.activeColor=this.paletteColors[0],this.colorPalette.setActiveColor(this.activeColor),this.board.setActiveColor(this.activeColor),this.colorPalette.setUpdateActiveColorFunction((t=>(this.setActiveColor(t),this.board.setActiveColor(t),this))),this.board.setUpdateActiveColorFunction((t=>(this.setActiveColor(t),this.colorPalette.setActiveColor(t),this))),this.navbar=t(this,"nav","id=blockArtNavbar"),this.funcButtonContainer=t(this.navbar,"div","id=funcButtonContainer"),t(this.funcButtonContainer,"button","content=Toggle Gap").addEventListener("click",(t=>e(this,"sk-bl-ockart").board.toggleGap())),t(this.funcButtonContainer,"button","content=Save Board").addEventListener("click",this.saveBoard),t(this.funcButtonContainer,"button","content=Scale +").addEventListener("click",(t=>e(this,"sk-bl-ockart").board.scaleBoard(1))),t(this.funcButtonContainer,"button","content=Scale -").addEventListener("click",(t=>e(this,"sk-bl-ockart").board.scaleBoard(-1))),t(this.funcButtonContainer,"button","content=ToggleBrush").addEventListener("click",(t=>e(this,"sk-bl-ockart").board.toggleBrushFill())),this.navbar.appendChild(this.colorPalette),this.appendChild(this.board)}__initState(t){this.colorPalette.resetColorPallette(t.paletteColors),this.board.__initState(t)}saveBoard(t){const o=e(this,"sk-bl-ockart"),s={size:o.board.blockAmount,paletteColors:o.paletteColors,gap:o.board.gap,blockValues:o.board.saveBoardState()},i=new c("BoardStates"),l=window.location.search;if(l){const t=l.substr(1).split("id=")[1];return i.updateBoard(Number(t),s),o.Toast.message({ttl:o.ToastTTL,msg:"Board saved!"})}return i.saveNewBoard(s),o.Toast.message({ttl:o.ToastTTL,msg:"Board saved!"})}}customElements.define("sk-bl-ockart",u),customElements.define("sk-color-palette",a),customElements.define("sk-board",n),customElements.define("sk-block",i),customElements.define("sk-row",h);const d=u,b=document.getElementById("root");t(b,"aside","id=toastContainer");const p=new d({blockAmount:22,blockSize:22,blockColor:"#e0e0e0"});b.appendChild(p),new class{constructor(t){this.blockArtBoard=t,this.LcAPi=new c("BoardStates"),this.__initRoute()}__initRoute(){const t=window.location.search;if(!t)return void this.loadRoute(this.LcAPi.length);const o=t.substr(1).split("id=")[1];return this.loadBoard(o)}loadBoard(t){if(!t)return;const o=this.LcAPi[parseInt(t)];o&&this.blockArtBoard.__initState(o)}loadRoute(t){const o=new URL(window.location);o.searchParams.set("id",t),window.history.pushState({},"",o),this.loadBoard(t)}}(p)})();